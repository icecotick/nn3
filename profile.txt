import discord
from discord.ext import commands
from utils.database import get_balance, get_user_clan, get_profile_description, update_profile_description

class Profile(commands.Cog):
    def __init__(self, bot):
        self.bot = bot

    @commands.command(name="–ø—Ä–æ—Ñ–∏–ª—å")
    async def profile(self, ctx, member: discord.Member = None):
        if not member:
            member = ctx.author
        
        balance = await get_balance(member.id, self.bot.db)
        clan = await get_user_clan(member.id, self.bot.db)
        description = await get_profile_description(member.id, self.bot.db)
        
        embed = discord.Embed(
            title=f"–ü—Ä–æ—Ñ–∏–ª—å {member.name}",
            color=member.color
        )
        
        avatar_url = member.avatar.url if member.avatar else member.default_avatar.url
        embed.set_thumbnail(url=avatar_url)
        
        embed.add_field(name="üí∞ –ë–∞–ª–∞–Ω—Å", value=f"{balance} –∫—Ä–µ–¥–∏—Ç–æ–≤", inline=True)
        embed.add_field(name="üë• –ö–ª–∞–Ω", value=clan if clan else "–ù–µ—Ç –∫–ª–∞–Ω–∞", inline=True)
        embed.add_field(name="üìù –û–ø–∏—Å–∞–Ω–∏–µ", value=description, inline=False)
        embed.set_footer(text=f"ID: {member.id}")
        
        await ctx.send(embed=embed)

    @commands.command(name="–æ–ø–∏—Å–∞–Ω–∏–µ_–ø—Ä–æ—Ñ–∏–ª—å")
    async def set_profile_description(self, ctx, *, description: str):
        if len(description) > 200:
            await ctx.send("‚ùå –û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 200 —Å–∏–º–≤–æ–ª–æ–≤!")
            return
        
        await update_profile_description(ctx.author.id, description, self.bot.db)
        await ctx.send("‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–æ!")

async def setup(bot):
    await bot.add_cog(Profile(bot))